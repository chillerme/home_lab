---
- hosts: all
  gather_facts: true
  tasks:
  - name: Downloading Trellix
    get_url:
      url: http://hrtsofpic2repo8/trellix/installrpm.sh
      dest: /root
      mode: '0755'
    register: download
  
  - name: Install Trellix
    ansible.builtin.shell: sh installrpm.sh -i
    args:
      chdir: /root/
    register: install_output
      failed_when: "'An higher or same version of the agent is already installed. Installation cannot continue' not in install_output.stdout"

  - name: Remove shell script from remote server
    file:
      path: /root/installrpm.sh
      state: absent
